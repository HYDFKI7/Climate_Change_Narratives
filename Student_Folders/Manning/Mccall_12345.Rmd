---
title: "Draft Regional Analysis "
author: "Claire Manning"
date: "9/12/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## How is Climate Change Affecting Farmers in McCall?

![Payette Lake, McCall](https://www.weather-us.com/weather/images/city/4/3/2349334-1500.jpg)

## How is climate change affecting McCall in general?

To start off, this is a big question, with a big, complicated answer. In short, many components of climate change are being noticed by residents, specifically the rising temperatures, which are causing numerous ecological and economic implications in the area. Some of the ecological changes that are occurring include disruption to wildlife habitats that result from increased forest fires, as well as physical changes to the landscape. One example of this can be seen in many of the pine forests in the area: pine beetles. Rising temperatures have extended the season that pine beetles can survive, and caused an increase in the scope of pine beetle damage. Pine beetle infestations result in huge areas of dead forests that are much more prone to fires, which disrupts the habitats of many other species, and is much less attractive for outdoor recreation activities such as hiking, backpacking and mountain biking. Other ecological implications that are resulting from rising temperatures includes earlier snowmelt, and increases in the speed of streamflow. These patterns result in changes in resource availability and disruptions to water management. The degradation and changes in the local environment are also causing disruptions to the local tourist economy, which is very important to the local economy as a whole. Rising temperatures have caused the main tourist seasons to shorten, most notably the winter sports season. 


```{r readdata, echo=FALSE, results='hide'}
# path to Data/FA20/ using marc's username...
#filepath = "/home/CAMPUS/mwl04747/github/Climate_Change_Narratives/Data/FA20/manning_mccall_data.csv"
filepath= "/home/CAMPUS/cemc2018/Climate_Change_Narratives/Student_Folders/Manning/manning_mccall_data.csv"
climate_data=read.csv(filepath)
#Change dataframe to readable dates
str(climate_data)
min(climate_data$TMAX)
strDates <- as.character(climate_data$DATE)
climate_data$NewDate <- as.Date(strDates, "%Y-%m-%d")
```
```{r plotingdailydata, include=FALSE, results='hide'}
#Plot data
plot(TMAX~NewDate, climate_data, ty='l') 
lm(TMAX ~ NewDate, data=climate_data)
TMAX.lm = lm(TMAX ~ NewDate, data= climate_data)
slopeintercept = coef(TMAX.lm)
plot(TMAX ~ NewDate, data= climate_data, las=1)
abline(slopeintercept, col="red", lwd=3)
(TMAX.lm.sum = summary(lm(TMAX ~ NewDate, data=climate_data)))
climate_data$Month = format(as.Date(climate_data$NewDate), format = "%m")
climate_data$Year = format(climate_data$NewDate, format="%Y")
#Claculating Monthly Mean
MonthlyTMAXMean = aggregate(TMAX ~ Month + Year, climate_data, mean)
MonthlyTMAXMean$YEAR = as.numeric(MonthlyTMAXMean$Year)
MonthlyTMAXMean$MONTH = as.numeric(MonthlyTMAXMean$Month)
str(MonthlyTMAXMean)
plot(MonthlyTMAXMean$TMAX, ty='l')
#plot(MonthlyTMAXMean£TMAX[MonthlyTMAXMean£Month=="05"], ty='l')
plot(TMAX~YEAR, data=MonthlyTMAXMean[MonthlyTMAXMean$Month=="05",],
ty='l', xlim=c(1950, 2020))
May.lm <- lm(TMAX~YEAR, data=MonthlyTMAXMean[MonthlyTMAXMean$Month=="05",])
summary(May.lm)
abline(coef(May.lm), col="red")
```
```{r plotingmin, include=FALSE, results='hide'}
#Analyzing minimum daily temperatures
MonthlyTMINMean = aggregate(TMIN ~ Month + Year, climate_data, mean)
MonthlyTMINMean$YEAR = as.numeric(MonthlyTMINMean$Year)
# Fixing the Format of Month and Year as numeric
MonthlyTMINMean$YEAR = as.numeric(MonthlyTMINMean$Year)
MonthlyTMINMean$MONTH = as.numeric(MonthlyTMINMean$Month)
head(MonthlyTMINMean)
# create a vector of months
Months = c("January", "February", "March", "April",
"May", "June", "July", "August", "September", "October","November", "December")
# Create a panel so I can see all the figures at once.
par(mfrow = c(4, 3), mar = c(5, 4, 3, 2) + 0.1)
TMAXresult <- NA
TMINresult <- NA
```


```{r include=FALSE, results='hide'}
#TMAX monthy changes
for (i in 1:12) {
plot(TMAX ~ YEAR, data = MonthlyTMAXMean[MonthlyTMAXMean$MONTH ==
i, ], ty = "l", las = 1, main = Months[i])
Month.lm <- lm(TMAX ~ YEAR, data = MonthlyTMAXMean[MonthlyTMAXMean$MONTH ==
i, ])
summary(Month.lm)
abline(coef(Month.lm), col = "red")
TMAXresult <- rbind(TMAXresult, cbind(Months[i],
round(coef(Month.lm)[2], 4), round(summary(Month.lm)$coefficients[2,
4], 4), round(summary(Month.lm)$r.squared,
3)))}
```



## What do these rises in temperature look like?

 To help visualize this increase in temperature, I analyzed data collected from a weather station in McCall, Idaho and created a few graphs showing these temperature changes over time. This particular station is at an elevation of 1531.6 m and the data goes back to March, 1906 with 91% data coverage. The data includes daily minimum and maximum temperatures at the station location on each given date. The equipment used for these measurements are stated as “Unknown” until 1991, when they started using max-min thermometers. In 1997 the station switched to using Mmts Electronic Sensor, and in 2011, they switched again to using Nimbus. I made graphs to depict the changes in daily maximum and daily minimum temperatures by month over the data period by changing the data from daily highs and lows to monthly means. The graphs of minimum temperature show the most notable changes over time, especially during late winter and spring. Because of this, I have chosen to include the graphs showing the tmin increases in temperature from January to June. The graphs below show these changes.


```{r tminmonthly, echo=FALSE}
#TMIN monthy changes
for (i in 1:6) {
plot(TMIN ~ YEAR, data = MonthlyTMINMean[MonthlyTMINMean$MONTH ==
i, ], ty = "l", las = 1, main = Months[i])
Month.lm <- lm(TMIN ~ YEAR, data = MonthlyTMINMean[MonthlyTMINMean$MONTH ==
i, ])
summary(Month.lm)
abline(coef(Month.lm), col = "red")
TMINresult <- rbind(TMINresult, cbind(Months[i],
round(coef(Month.lm)[2], 4), round(summary(Month.lm)$coefficients[2,
4], 4), round(summary(Month.lm)$r.squared,
3)))}
```
##How are these changes affecting farmers?

These changes in climate are affecting nearly every aspect of life for residents of McCall whether they consciously realize it or not, and unfortunately many residents are not connecting the changes in the local climate to the overall human-caused global climate change. Farmers are a unique group because their life and job require constant attention to the local weather and climate. The rising temperatures that result from climate change are increasing instances of drought and causing insect infestations. They also indirectly cause disruptions in water management and the availability of water for irrigation. Many farmers fall into the group of residents that are not making these connections and this often happens in connection with strong political and religious ideologies. The reality is that regardless of religious beliefs or political ideologies, the local climate is changing and temperatures are rising. It is important to understand that accepting this fact doesn’t invalidate or undermine any group’s religious beliefs or political ideologies. Instead it helps the community, understand the efforts and tangible changes that farmers and individuals can make to work toward achieving sustainability, for example making the switch to organic farming. Making shifts toward sustainability will positively impact the productivity of farms, and over the long run, will likely reduce the severity of water issues, such as drought, pollution from fertilizer runoff, and algal blooms. 



```{r monthlytable, include=FALSE, results='hide'}
library(xtable)
Results <- data.frame(Month = TMINresult[c(1:6),1],
TMINSlope = TMINresult[c(1:6),2],
TMIN_P = as.numeric(TMINresult[c(1:6),3]), TMINRsq = TMINresult[c(1:6),4],
TMAXSlope = TMAXresult[c(1:6),2],
TMAX_P = as.numeric(TMAXresult[c(1:6),3]), TMAXRsq = TMAXresult[c(1:6),4])
Results$starTMIN = "NS"
Results$starTMIN[Results$TMIN_P <= .05] = "*" 
Results$starTMIN[Results$TMIN_P < 0.01] = "**" 
Results$starTMIN[Results$TMIN_P < 0.001] = "***" 
Results$starTMAX = "NS"
Results$starTMAX[Results$TMAX_P < 0.05] = "*" 
Results$starTMAX[Results$TMAX_P < 0.01] = "**" 
Results$starTMAX[Results$TMAX_P < 0.001] = "***" 
Results$TMINslope=paste(Results$TMINSlope, Results$starTMIN)
Results$TMAXslope=paste(Results$TMAXSlope, Results$starTMAX) 
colnames(Results) <- c("Month", "2", "3", "R^2", "5", "6","R^2", "8", "9", "Slope TMIN", "Slope TMAX") 
print(xtable(Results[,c(1, 10, 4, 11, 7)]))
```

```{r tableslopes, echo=FALSE, results='hide'}
#The first the line of code does not run for me
#TMAXSlope = TMAXresult[c(2:13),2]
#TMAX_P = as.numeric(TMAXresult[c(2:13),3])

#TMAXRsq = TMAXresult[c(2:13),4])
#Results$starTMIN = "NS"
#Results$starTMIN[Results$TMIN_P <= .05] = "*"
#Results$starTMIN[Results$TMIN_P < 0.01] = "**"
#Results$starTMIN[Results$TMIN_P < 0.001] = "***"
#Results$starTMAX = "NS"
#Results$starTMAX[Results$TMAX_P < 0.05] = "*"
#Results$starTMAX[Results$TMAX_P < 0.01] = "**"
#Results$starTMAX[Results$TMAX_P < 0.001] = "***"
#Results$TMINslope=paste(Results$TMINSlope, Results$starTMIN)
#Results$TMAXslope=paste(Results$TMAXSlope, Results$starTMAX)
#colnames(Results) <- c("Month", "2", "3", "R^2", "5", "6",
#"R^2", "8", "9", "Slope TMIN", "Slope TMAX")
#print(xtable(Results[,c(1, 10, 4, 11, 7)]))
```


```{r precipitation, include=FALSE, results='hide'}
##Precipitation: Departure from Mean
climate_data$PRCP[climate_data$PRCP==-9999] <- NA
Missing <- aggregate(is.na(climate_data$PRCP),
list(climate_data$Month, climate_data$Year), sum)
# The aggregate command is used to create a simplified dataset. In this case
# we are creating a sum of PRCP based on each month and year.
Missing$Date = as.numeric(Missing$Group.1) + as.numeric(Missing$Group.2)/12
plot(x ~ Date, data=Missing)
```


```{r paggregate, include=FALSE, results='hide'}
#aggreate by month and year to get monthly totals
#cut out the months that have more than 4 missing days.
TotalPPT <- aggregate(climate_data$PRCP,
list(climate_data$Month, climate_data$Year), sum, na.rm=T)
names(TotalPPT) = c("Group.1", "Group.2", "ppt")
NonMissing <- Missing[Missing$x < 5, c(1:3)]
library(dplyr)
PPT <- merge(TotalPPT, NonMissing, all.y=TRUE)
PPT$Date <- as.numeric(PPT$Group.1) + as.numeric(PPT$Group.2)/12
head(PPT)
#Finding the mean
PRCP_mean = mean(PPT$ppt)
plot(ppt~Date, data=PPT)
abline(h=PRCP_mean, col="blue")
```


```{r lookingmore, include=FALSE, results='hide'}
#Looking at a few months code will not run so i put it all in ##
#STATION£PRCP[STATION~PRCP==-9999] <- NA
#YearlySum = aggregate(PRCP ~ Year, NAME, sum)
#YearlySum£YEAR = as.numeric(YearlySum£Year)
#YearlyMean = mean(YearlySum£PRCP)
#plot(PRCP~YEAR, data=YearlySum, las=1, ty="p")
#abline(h=YearlyMean, col="blue")
#YearlySum.lm = lm(PRCP~YEAR, data=YearlySum)
#abline(coef(YearlySum.lm), col="green")
#n <- 5
#k <- rep(1/n, n)
#k
#y_lag <- stats::filter(YearlySum£PRCP, k, sides=1)
#lines(YearlySum~YEAR, y_lag, col="red")
#summary(YearlySum.lm)
```


```{r ModelDiagnostics, include=FALSE}
par(mfrow=c(2,2))
plot(lm(TMIN ~ YEAR, data=MonthlyTMINMean[MonthlyTMINMean$MONTH==1,]))
```

